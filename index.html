<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>DeutschMeister Pro | C1 System</title>
    
    <!-- –ü–æ–¥–∫–ª—é—á–∞–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫–∏ —á–µ—Ä–µ–∑ CDN (–Ω–µ –Ω—É–∂–Ω–æ –Ω–∏—á–µ–≥–æ —Å–∫–∞—á–∏–≤–∞—Ç—å) -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <!-- –ò–∫–æ–Ω–∫–∏ Lucide -->
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;700;900&display=swap');
        body { font-family: 'Inter', sans-serif; -webkit-tap-highlight-color: transparent; }
        .glass { background: rgba(255, 255, 255, 0.8); backdrop-filter: blur(12px); }
        .task-card:active { transform: scale(0.98); }
        .nav-active { color: #4f46e5; }
        /* –ê–Ω–∏–º–∞—Ü–∏–∏ */
        .fade-in { animation: fadeIn 0.3s ease-out forwards; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }
    </style>
</head>
<body class="bg-slate-50">
    <div id="root"></div>

    <!-- FIREBASE SDK -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, onAuthStateChanged, signOut, signInAnonymously } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, doc, setDoc, onSnapshot } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- –í–°–¢–ê–í–¨ –°–í–û–ò –î–ê–ù–ù–´–ï –°–Æ–î–ê ---
        const firebaseConfig = {
            apiKey: "AIzaSyBRAeIilgqixdDrBQFThpx00D2Te0gPuY0",
            authDomain: "deutschmeister-489ea.firebaseapp.com",
            projectId: "deutschmeister-489ea",
            storageBucket: "deutschmeister-489ea.firebasestorage.app",
            messagingSenderId: "82755973685",
            appId: "1:82755973685:web:f94383816d8fda927a777c"
        };

        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);
        const provider = new GoogleAuthProvider();

        // –ü—Ä–æ–±—Ä–∞—Å—ã–≤–∞–µ–º Firebase –≤ React —á–µ—Ä–µ–∑ –≥–ª–æ–±–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ
        window.fb = { auth, db, provider, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, doc, setDoc, onSnapshot, signInAnonymously };
    </script>

    <!-- –ü–†–ò–õ–û–ñ–ï–ù–ò–ï (REACT) -->
    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;

        const PHASES = [
            { id: 0, level: 'A1', name: '–§—É–Ω–¥–∞–º–µ–Ω—Ç', days: 90, resources: 'Nicos Weg A1', tasksA: [{id:'a1_1', title:'–ê–Ω–∞–ª–∏–∑ Nicos Weg', time:20, type:'Input'}, {id:'a1_2', title:'–°–æ–∑–¥–∞–Ω–∏–µ –∫–∞—Ä—Ç Anki', time:10, type:'Input'}, {id:'a1_3', title:'ChatGPT: –ì—Ä–∞–º–º–∞—Ç–∏–∫–∞', time:10, type:'Study'}], tasksB: [{id:'b1_1', title:'Shadowing (NW)', time:15, type:'Output'}, {id:'b1_2', title:'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', time:15, type:'Memory'}, {id:'b1_3', title:'SST: –ú–æ–Ω–æ–ª–æ–≥', time:10, type:'Output'}] },
            { id: 1, level: 'A2', name: '–ö–∞—Ä–∫–∞—Å', days: 90, resources: 'Nicos Weg A2', tasksA: [{id:'a2_1', title:'Perfekt –ê–Ω–∞–ª–∏–∑', time:20, type:'Input'}, {id:'a2_2', title:'Dino lernt Deutsch', time:15, type:'Input'}, {id:'a2_3', title:'Anki: –ù–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã', time:5, type:'Memory'}], tasksB: [{id:'b2_1', title:'–ú–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å', time:20, type:'Output'}, {id:'b2_2', title:'Anki: –°–µ—Ç', time:15, type:'Memory'}, {id:'b2_3', title:'ChatGPT: –ü—Ä–æ–≤–µ—Ä–∫–∞', time:5, type:'Output'}] },
            { id: 2, level: 'B1', name: '–ü–æ—Ä–æ–≥', days: 150, resources: 'Nicos Weg B1', tasksA: [{id:'a3_1', title:'Intensive Reading', time:25, type:'Input'}, {id:'a3_2', title:'Anki: –§—Ä–∞–∑—ã', time:10, type:'Memory'}, {id:'a3_3', title:'Nebens√§tze –ê–Ω–∞–ª–∏–∑', time:5, type:'Study'}], tasksB: [{id:'b3_1', title:'–ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è (Weil)', time:20, type:'Output'}, {id:'b3_2', title:'Easy German Podcast', time:15, type:'Output'}, {id:'b3_3', title:'Anki: –°–µ—Ç', time:5, type:'Memory'}] },
            { id: 3, level: 'B2', name: '–ò–º–º–µ—Ä—Å–∏—è', days: 120, resources: 'Tschick (–†–æ–º–∞–Ω)', tasksA: [{id:'a4_1', title:'Tschick: –ß—Ç–µ–Ω–∏–µ', time:25, type:'Input'}, {id:'a4_2', title:'–ö–æ–ª–ª–æ–∫–∞—Ü–∏–∏ Anki', time:10, type:'Memory'}, {id:'a4_3', title:'Passiv: –ê–Ω–∞–ª–∏–∑', time:5, type:'Study'}], tasksB: [{id:'b4_1', title:'–†–µ—Ü–µ–Ω–∑–∏—è (–ü–∏—Å—å–º–æ)', time:20, type:'Output'}, {id:'b4_2', title:'SST: –î–µ–±–∞—Ç—ã', time:15, type:'Output'}, {id:'b4_3', title:'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', time:5, type:'Memory'}] },
            { id: 4, level: 'C1', name: '–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ', days: 97, resources: 'Die Zeit', tasksA: [{id:'a5_1', title:'Die Zeit: –ê–Ω–∞–ª–∏–∑', time:25, type:'Input'}, {id:'a5_2', title:'–¢–µ—Ä–º–∏–Ω—ã C1', time:10, type:'Memory'}, {id:'a5_3', title:'TestDaF: –ß—Ç–µ–Ω–∏–µ', time:5, type:'Study'}], tasksB: [{id:'b5_1', title:'–≠—Å—Å–µ –Ω–∞ –≤—Ä–µ–º—è', time:25, type:'Output'}, {id:'b5_2', title:'–ú–æ–Ω–æ–ª–æ–≥ (–¢–∞–π–º–µ—Ä)', time:10, type:'Output'}, {id:'b5_3', title:'Anki: –§–∏–Ω–∞–ª', time:5, type:'Memory'}] }
        ];

        function App() {
            const [user, setUser] = useState(null);
            const [view, setView] = useState('home');
            const [state, setState] = useState({ currentPhaseId: 0, completedTasks: [], streak: 0, startDate: new Date().toISOString(), lastActivity: new Date().toDateString(), autoAdvance: true });

            useEffect(() => {
                const unsub = window.fb.onAuthStateChanged(window.fb.auth, (u) => {
                    if (!u) window.fb.signInAnonymously(window.fb.auth);
                    setUser(u);
                });
                return () => unsub();
            }, []);

            useEffect(() => {
                if (!user) return;
                const docRef = window.fb.doc(window.fb.db, "artifacts", "german-pro", "users", user.uid, "settings", "state");
                const unsub = window.fb.onSnapshot(docRef, (docSnap) => {
                    if (docSnap.exists()) setState(prev => ({ ...prev, ...docSnap.data() }));
                });
                return () => unsub();
            }, [user]);

            const save = (ns) => {
                if (!user) return;
                const docRef = window.fb.doc(window.fb.db, "artifacts", "german-pro", "users", user.uid, "settings", "state");
                window.fb.setDoc(docRef, ns);
            };

            const daysPassed = useMemo(() => {
                return Math.max(0, Math.floor((new Date() - new Date(state.startDate)) / 86400000));
            }, [state.startDate]);

            const isDayA = daysPassed % 2 === 0;
            const currentPhase = PHASES[state.currentPhaseId];
            const tasks = isDayA ? currentPhase.tasksA : currentPhase.tasksB;

            const toggleTask = (id) => {
                const isDone = state.completedTasks.includes(id);
                const nt = isDone ? state.completedTasks.filter(t => t !== id) : [...state.completedTasks, id];
                const today = new Date().toDateString();
                let ns = state.streak;
                if (!isDone && state.lastActivity !== today) ns += 1;
                const newState = { ...state, completedTasks: nt, lastActivity: today, streak: ns };
                setState(newState);
                save(newState);
            };

            return (
                <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col pb-24 shadow-xl">
                    <header className="bg-white/80 p-5 flex justify-between items-center sticky top-0 z-50 border-b border-slate-100">
                        <div>
                            <h1 className="text-xl font-black tracking-tighter">DEUTSCH<span className="text-indigo-600">MEISTER</span></h1>
                            <p className="text-[10px] text-slate-400 font-bold uppercase tracking-widest">Tag {daysPassed + 1}/547 ‚Ä¢ C1 Blueprint</p>
                        </div>
                        <button onClick={() => user?.isAnonymous ? window.fb.signInWithPopup(window.fb.auth, window.fb.provider) : window.fb.signOut(window.fb.auth)} className="w-10 h-10 rounded-2xl bg-indigo-50 border-2 border-indigo-100 flex items-center justify-center overflow-hidden">
                            {user?.photoURL ? <img src={user.photoURL} /> : <span className="text-indigo-600 text-sm font-bold">üë§</span>}
                        </button>
                    </header>

                    <main className="p-6 flex-grow overflow-y-auto">
                        {view === 'home' && (
                            <div className="space-y-6 fade-in">
                                <div className="flex justify-between items-end">
                                    <div className="space-y-1">
                                        <p className="text-sm font-bold text-slate-400 uppercase tracking-widest">–¶–∏–∫–ª {isDayA ? 'A (Input)' : 'B (Output)'}</p>
                                        <h2 className="text-2xl font-black text-slate-900 leading-tight">40 –º–∏–Ω—É—Ç —Ñ–æ–∫—É—Å–∞</h2>
                                    </div>
                                    <div className="flex flex-col items-end gap-1">
                                        <span className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full border border-indigo-200 uppercase">{currentPhase.level}</span>
                                        <span className="text-[10px] text-orange-500 font-bold">üî• Streak: {state.streak}</span>
                                    </div>
                                </div>

                                <div className="bg-slate-900 rounded-[2.5rem] p-8 text-white shadow-2xl relative overflow-hidden">
                                    <div className="relative z-10 space-y-4">
                                        {tasks.map(t => (
                                            <div key={t.id} onClick={() => toggleTask(t.id)} className="flex items-center gap-4 bg-white/5 p-4 rounded-3xl border border-white/5 cursor-pointer hover:bg-white/10 transition-all active:scale-95">
                                                <div className={`w-7 h-7 rounded-xl border-2 flex items-center justify-center ${state.completedTasks.includes(t.id) ? 'bg-indigo-500 border-indigo-500 shadow-lg' : 'border-white/20'}`}>
                                                    {state.completedTasks.includes(t.id) && <span className="text-xs">‚úì</span>}
                                                </div>
                                                <div className="flex-grow">
                                                    <p className={`font-bold text-sm ${state.completedTasks.includes(t.id) ? 'line-through opacity-40' : ''}`}>{t.title}</p>
                                                    <p className="text-[9px] font-bold text-white/40 uppercase tracking-widest mt-1">{t.time} –ú–ò–ù ‚Ä¢ {t.type}</p>
                                                </div>
                                            </div>
                                        ))}
                                    </div>
                                    <div className="absolute -bottom-10 -right-10 w-48 h-48 bg-indigo-500/20 blur-[80px] rounded-full"></div>
                                </div>
                            </div>
                        )}

                        {view === 'map' && (
                            <div className="space-y-4 fade-in">
                                <h2 className="text-2xl font-black mb-6">–î–æ—Ä–æ–∂–Ω–∞—è –∫–∞—Ä—Ç–∞ C1</h2>
                                {PHASES.map(p => (
                                    <div key={p.id} onClick={() => { if(confirm('–°–º–µ–Ω–∏—Ç—å —ç—Ç–∞–ø?')) { const ns = {...state, currentPhaseId: p.id}; setState(ns); save(ns); setView('home'); } }} className={`p-6 rounded-[2rem] border-2 transition-all cursor-pointer relative ${state.currentPhaseId === p.id ? 'bg-indigo-600 text-white border-indigo-500' : 'bg-white border-slate-100 opacity-60'}`}>
                                        <div className="flex justify-between items-center mb-2">
                                            <span className="text-[10px] font-bold uppercase">{p.days} –¥–Ω–µ–π</span>
                                            <span className="font-black text-xl">{p.level}</span>
                                        </div>
                                        <h3 className="font-black text-lg">{p.name}</h3>
                                        <p className="text-[11px] opacity-80 mt-1">{p.resources}</p>
                                    </div>
                                ))}
                            </div>
                        )}

                        {view === 'guide' && (
                            <div className="space-y-6 fade-in">
                                <h2 className="text-2xl font-black">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è</h2>
                                <div className="bg-white p-6 rounded-[2rem] border border-slate-100 space-y-4 shadow-sm">
                                    <h4 className="font-bold text-indigo-600">–°–∏—Å—Ç–µ–º–∞ 2-—Ö –¥–Ω–µ–π</h4>
                                    <p className="text-[11px] text-slate-500 leading-relaxed">–î–µ–Ω—å –ê: –ß—Ç–µ–Ω–∏–µ, –∞–Ω–∞–ª–∏–∑ –≥—Ä–∞–º–º–∞—Ç–∏–∫–∏, –Ω–∞–∫–æ–ø–ª–µ–Ω–∏–µ –ª–µ–∫—Å–∏–∫–∏. <br/> –î–µ–Ω—å –ë: –¢–µ–Ω–µ–≤–æ–π –ø–æ–≤—Ç–æ—Ä (Shadowing), –≥–æ–≤–æ—Ä–µ–Ω–∏–µ, –∞–∫—Ç–∏–≤–∞—Ü–∏—è –ø–∞–º—è—Ç–∏.</p>
                                </div>
                                <div className="bg-slate-900 p-6 rounded-[2rem] text-white space-y-3">
                                    <h4 className="font-bold">Anki: –†–æ–¥–∞ (Gender Coding)</h4>
                                    <div className="flex gap-2">
                                        <span className="flex-grow p-2 bg-blue-500 rounded-xl text-[9px] font-bold text-center">DER - –°–ò–ù–ò–ô</span>
                                        <span className="flex-grow p-2 bg-red-500 rounded-xl text-[9px] font-bold text-center">DIE - –ö–†–ê–°–ù–´–ô</span>
                                        <span className="flex-grow p-2 bg-emerald-500 rounded-xl text-[9px] font-bold text-center">DAS - –ó–ï–õ–ï–ù–´–ô</span>
                                    </div>
                                </div>
                            </div>
                        )}

                        {view === 'settings' && (
                          <div className="space-y-6 fade-in">
                              <h2 className="text-2xl font-black">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
                              <div className="bg-white p-7 rounded-[2rem] border border-slate-100 shadow-sm space-y-4">
                                  <button onClick={() => window.open(`https://www.google.com/calendar/render?action=TEMPLATE&text=DeutschMeister%20Training&details=40%20min%20German&recur=RRULE:FREQ=DAILY`, '_blank')} className="w-full flex items-center justify-between p-4 bg-indigo-50 rounded-2xl text-indigo-700 font-bold text-xs transition-all active:scale-95 border border-indigo-100">
                                      <span>–°–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∏—Ä–æ–≤–∞—Ç—å Google</span>
                                      <span>üìÖ</span>
                                  </button>
                                  <button onClick={() => { if(confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å?')) { const ns = { ...state, startDate: new Date().toISOString(), currentPhaseId: 0, streak: 0, completedTasks: [] }; setState(ns); save(ns); } }} className="w-full p-4 text-center text-rose-500 font-bold text-[10px] uppercase tracking-widest bg-rose-50 rounded-2xl border border-rose-100">–°–±—Ä–æ—Å–∏—Ç—å –æ–±—É—á–µ–Ω–∏–µ</button>
                              </div>
                          </div>
                        )}
                    </main>

                    <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-slate-100 px-6 pb-10 pt-4 z-50">
                        <div className="max-w-md mx-auto flex justify-around">
                            <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'home' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}><span className="text-2xl">‚ö°</span><span className="text-[9px] font-black uppercase">–ü–ª–∞–Ω</span></button>
                            <button onClick={() => setView('map')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'map' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}><span className="text-2xl">üó∫Ô∏è</span><span className="text-[9px] font-black uppercase">–ö–∞—Ä—Ç–∞</span></button>
                            <button onClick={() => setView('guide')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'guide' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}><span className="text-2xl">üìñ</span><span className="text-[9px] font-black uppercase">–ì–∞–π–¥</span></button>
                            <button onClick={() => setView('settings')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'settings' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}><span className="text-2xl">‚öôÔ∏è</span><span className="text-[9px] font-black uppercase">–û–ø—Ü–∏–∏</span></button>
                        </div>
                    </nav>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>

