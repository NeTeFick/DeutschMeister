import React, { useState, useEffect, useMemo, useCallback } from 'react';
import { initializeApp } from 'firebase/app';
import { 
  getAuth, 
  signInWithPopup, 
  GoogleAuthProvider, 
  onAuthStateChanged, 
  signOut,
  signInAnonymously,
  signInWithCustomToken
} from 'firebase/auth';
import { 
  getFirestore, 
  doc, 
  setDoc, 
  onSnapshot 
} from 'firebase/firestore';
import { 
  BookOpen, 
  Map, 
  Settings, 
  Zap, 
  Target, 
  Award, 
  Info, 
  Copy, 
  CheckCircle2, 
  Calendar,
  AlertTriangle,
  Flame
} from 'lucide-react';

// --- –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è Firebase ---
const firebaseConfig = JSON.parse(__firebase_config);
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const db = getFirestore(app);
const appId = typeof __app_id !== 'undefined' ? __app_id : 'german-pro-v6';

// --- –ö–æ–Ω—Å—Ç–∞–Ω—Ç—ã –ø—Ä–æ–≥—Ä–∞–º–º—ã (–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π –æ—Ç—á–µ—Ç) ---
const PHASES = [
  { 
    id: 0, level: 'A1', name: '–ó–∞–∫–ª–∞–¥–∫–∞ —Ñ—É–Ω–¥–∞–º–µ–Ω—Ç–∞', days: 90, 
    resources: 'Nicos Weg A1, Caf√© in Berlin',
    focus: '–§–æ–Ω–µ—Ç–∏–∫–∞, –¢–æ–ø-500 —Å–ª–æ–≤, V2 Rule',
    tasksA: [
      { id: 'a1_1', title: 'Nicos Weg: –î–µ–∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏–µ', time: 20, type: 'Input' },
      { id: 'a1_2', title: 'Anki: –°–æ–∑–¥–∞–Ω–∏–µ (–ö–æ–Ω—Ç–µ–∫—Å—Ç)', time: 10, type: 'Memory' },
      { id: 'a1_3', title: '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞: –ü–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤', time: 10, type: 'Study' }
    ],
    tasksB: [
      { id: 'b1_1', title: 'Shadowing (NW)', time: 15, type: 'Output' },
      { id: 'b1_2', title: 'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ (SM-2)', time: 15, type: 'Memory' },
      { id: 'b1_3', title: 'SST: –†–µ—á–µ–≤–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞', time: 10, type: 'Output' }
    ]
  },
  { 
    id: 1, level: 'A2', name: '–°—Ç—Ä–æ–∏—Ç–µ–ª—å—Å—Ç–≤–æ –∫–∞—Ä–∫–∞—Å–∞', days: 90, 
    resources: 'Nicos Weg A2, Ferien in Frankfurt',
    focus: 'Perfekt, Dativ, Wechselpr√§positionen',
    tasksA: [
      { id: 'a2_1', title: 'Perfekt: –ê–Ω–∞–ª–∏–∑ –≤ —Ç–µ–∫—Å—Ç–µ', time: 20, type: 'Input' },
      { id: 'a2_2', title: '–ß—Ç–µ–Ω–∏–µ Dino lernt Deutsch', time: 15, type: 'Input' },
      { id: 'a2_3', title: 'Anki: –ù–æ–≤—ã–µ —Ñ—Ä–∞–∑—ã', time: 5, type: 'Memory' }
    ],
    tasksB: [
      { id: 'b2_1', title: '–°–∏–Ω—Ç–µ–∑: –ú–æ–π –≤—á–µ—Ä–∞—à–Ω–∏–π –¥–µ–Ω—å', time: 20, type: 'Output' },
      { id: 'b2_2', title: 'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', time: 15, type: 'Memory' },
      { id: 'b2_3', title: 'ChatGPT: –ö–æ—Ä—Ä–µ–∫—Ü–∏—è —Ç–µ–∫—Å—Ç–∞', time: 5, type: 'Output' }
    ]
  },
  { 
    id: 2, level: 'B1', name: '–ü—Ä–µ–æ–¥–æ–ª–µ–Ω–∏–µ –ø–æ—Ä–æ–≥–∞', days: 150, 
    resources: 'Nicos Weg B1, Easy German Podcast',
    focus: 'Nebens√§tze, Pr√§teritum, Konjunktiv II',
    tasksA: [
      { id: 'a3_1', title: 'Intensive Reading (B1)', time: 25, type: 'Input' },
      { id: 'a3_2', title: 'Anki: –ö–æ–ª–ª–æ–∫–∞—Ü–∏–∏', time: 10, type: 'Memory' },
      { id: 'a3_3', title: '–ê–Ω–∞–ª–∏–∑ Nebens√§tze', time: 5, type: 'Study' }
    ],
    tasksB: [
      { id: 'b3_1', title: '–ê—Ä–≥—É–º–µ–Ω—Ç–∞—Ü–∏—è (Weil/Dass)', time: 20, type: 'Output' },
      { id: 'b3_2', title: 'Shadowing: Podcast', time: 15, type: 'Output' },
      { id: 'b3_3', title: 'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', time: 5, type: 'Memory' }
    ]
  },
  { 
    id: 3, level: 'B2', name: '–ò–º–º–µ—Ä—Å–∏—è –∏ –ù–∞—Ç–∏–≤–Ω–æ—Å—Ç—å', days: 120, 
    resources: 'Tschick (Novel), Dark (Netflix)',
    focus: 'Passiv, Substantivierung, –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ',
    tasksA: [
      { id: 'a4_1', title: 'Tschick (–ò–Ω—Ç–µ–Ω—Å–∏–≤–Ω–æ–µ —á—Ç–µ–Ω–∏–µ)', time: 25, type: 'Input' },
      { id: 'a4_2', title: 'Anki: –£—Å—Ç–æ–π—á–∏–≤—ã–µ –≤—ã—Ä–∞–∂–µ–Ω–∏—è', time: 10, type: 'Memory' },
      { id: 'a4_3', title: '–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞: Passiv', time: 5, type: 'Study' }
    ],
    tasksB: [
      { id: 'b4_1', title: '–†–µ—Ü–µ–Ω–∑–∏—è –Ω–∞ –≥–ª–∞–≤—É', time: 20, type: 'Output' },
      { id: 'b4_2', title: 'SST: –î–µ–±–∞—Ç—ã (ChatGPT)', time: 15, type: 'Output' },
      { id: 'b4_3', title: 'Anki: –ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ', time: 5, type: 'Memory' }
    ]
  },
  { 
    id: 4, level: 'C1', name: '–ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ –∏ –®–ª–∏—Ñ–æ–≤–∫–∞', days: 97, 
    resources: 'Die Zeit, Spiegel, Lage der Nation',
    focus: 'Nominalstil, –ê–∫–∞–¥–µ–º. –ø–∏—Å—å–º–æ, TestDaF',
    tasksA: [
      { id: 'a5_1', title: 'Die Zeit: –ê–Ω–∞–ª–∏–∑ —Å—Ç–∞—Ç—å–∏', time: 25, type: 'Input' },
      { id: 'a5_2', title: 'Anki: –¢–µ—Ä–º–∏–Ω–æ–ª–æ–≥–∏—è C1', time: 10, type: 'Memory' },
      { id: 'a5_3', title: 'TestDaF: Leseverstehen', time: 5, type: 'Study' }
    ],
    tasksB: [
      { id: 'b5_1', title: 'Schriftlicher Ausdruck', time: 25, type: 'Output' },
      { id: 'b5_2', title: 'M√ºndlicher Ausdruck (–¢–∞–π–º–µ—Ä)', time: 10, type: 'Output' },
      { id: 'b5_3', title: 'Anki: –§–∏–Ω–∞–ª—å–Ω—ã–π —Å–µ—Ç', time: 5, type: 'Memory' }
    ]
  }
];

// --- –í—Å–ø–æ–º–æ–≥–∞—Ç–µ–ª—å–Ω—ã–π –∫–æ–º–ø–æ–Ω–µ–Ω—Ç: SVG Donut Chart ---
const DonutChart = ({ tasks }) => {
  const total = tasks.reduce((acc, t) => acc + t.time, 0);
  let currentAngle = 0;
  
  return (
    <svg viewBox="0 0 100 100" className="w-full h-48 drop-shadow-xl">
      {tasks.map((task, i) => {
        const percentage = (task.time / total) * 100;
        const angle = (percentage / 100) * 360;
        const x1 = 50 + 40 * Math.cos((currentAngle - 90) * (Math.PI / 180));
        const y1 = 50 + 40 * Math.sin((currentAngle - 90) * (Math.PI / 180));
        const x2 = 50 + 40 * Math.cos((currentAngle + angle - 90) * (Math.PI / 180));
        const y2 = 50 + 40 * Math.sin((currentAngle + angle - 90) * (Math.PI / 180));
        const largeArcFlag = angle > 180 ? 1 : 0;
        const pathData = `M 50 50 L ${x1} ${y1} A 40 40 0 ${largeArcFlag} 1 ${x2} ${y2} Z`;
        currentAngle += angle;
        const colors = ['#6366f1', '#f59e0b', '#10b981'];
        return <path key={i} d={pathData} fill={colors[i % colors.length]} stroke="white" strokeWidth="1" />;
      })}
      <circle cx="50" cy="50" r="30" fill="white" />
    </svg>
  );
};

export default function App() {
  const [user, setUser] = useState(null);
  const [view, setView] = useState('home');
  const [loading, setLoading] = useState(true);
  const [copyStatus, setCopyStatus] = useState('');
  const [state, setState] = useState({
    currentPhaseId: 0,
    completedTasks: [],
    streak: 0,
    startDate: new Date().toISOString(),
    lastActivity: new Date().toDateString(),
    autoAdvance: true,
  });

  useEffect(() => {
    const init = async () => {
      try {
        if (typeof __initial_auth_token !== 'undefined' && __initial_auth_token) {
          await signInWithCustomToken(auth, __initial_auth_token);
        } else {
          await signInAnonymously(auth);
        }
      } catch (e) { console.error("Auth error", e); }
    };
    init();
    const unsub = onAuthStateChanged(auth, (u) => {
      setUser(u);
      setLoading(false);
    });
    return () => unsub();
  }, []);

  useEffect(() => {
    if (!user) return;
    const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'state');
    const unsub = onSnapshot(docRef, (docSnap) => {
      if (docSnap.exists()) {
        setState(prev => ({ ...prev, ...docSnap.data() }));
      } else {
        saveToCloud(state);
      }
    });
    return () => unsub();
  }, [user]);

  const saveToCloud = useCallback(async (ns) => {
    if (!user) return;
    const docRef = doc(db, 'artifacts', appId, 'users', user.uid, 'settings', 'state');
    await setDoc(docRef, ns);
  }, [user]);

  const daysPassed = useMemo(() => {
    const start = new Date(state.startDate);
    const today = new Date();
    return Math.max(0, Math.floor((today - start) / 86400000));
  }, [state.startDate]);

  const isDayA = daysPassed % 2 === 0;

  useEffect(() => {
    if (state.autoAdvance) {
      let targetId = 0;
      let cumDays = 0;
      for (const p of PHASES) {
        cumDays += p.days;
        if (daysPassed >= cumDays) targetId = Math.min(p.id + 1, PHASES.length - 1);
      }
      if (targetId !== state.currentPhaseId) {
        const ns = { ...state, currentPhaseId: targetId };
        setState(ns);
        saveToCloud(ns);
      }
    }
  }, [daysPassed, state.autoAdvance]);

  const isPlateauPhase = daysPassed >= 240 && daysPassed <= 254;

  const handleToggleTask = (tid) => {
    const isDone = state.completedTasks.includes(tid);
    const newTasks = isDone ? state.completedTasks.filter(id => id !== tid) : [...state.completedTasks, tid];
    const today = new Date().toDateString();
    let newStreak = state.streak;
    if (!isDone && state.lastActivity !== today) newStreak += 1;
    const ns = { ...state, completedTasks: newTasks, lastActivity: today, streak: newStreak };
    setState(ns);
    saveToCloud(ns);
  };

  const currentPhase = PHASES[state.currentPhaseId];
  const activeTasks = isDayA ? currentPhase.tasksA : currentPhase.tasksB;

  const copyPrompt = () => {
    const prompt = `–¢—ã ‚Äî –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω—ã–π DaF-–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å. –Ø —É—á—É –Ω–µ–º–µ—Ü–∫–∏–π –Ω–∞ —É—Ä–æ–≤–Ω–µ ${currentPhase.level}.
1. –ò—Å–ø—Ä–∞–≤–ª—è–π –æ—à–∏–±–∫–∏, —Å—Å—ã–ª–∞—è—Å—å –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞.
2. –î–∞–≤–∞–π –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è –Ω–∞ —É–ø—Ä–æ—â–µ–Ω–Ω–æ–º –Ω–µ–º–µ—Ü–∫–æ–º.
3. –í—Å–µ–≥–¥–∞ —É–∫–∞–∑—ã–≤–∞–π —Ä–æ–¥ (der/die/das) –∏ –º–Ω–æ–∂. —á–∏—Å–ª–æ.
4. –¢–≤–æ–π —É—Ä–æ–≤–µ–Ω—å —Å–ª–æ–∂–Ω–æ—Å—Ç–∏ –¥–æ–ª–∂–µ–Ω —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å –º–æ–µ–º—É —Ç–µ–∫—É—â–µ–º—É.`;
    navigator.clipboard.writeText(prompt);
    setCopyStatus('–°–∫–æ–ø–∏—Ä–æ–≤–∞–Ω–æ!');
    setTimeout(() => setCopyStatus(''), 2000);
  };

  if (loading) return (
    <div className="h-screen flex items-center justify-center bg-slate-900 text-white font-sans">
      <div className="flex flex-col items-center gap-6">
        <div className="w-16 h-16 border-4 border-indigo-500 border-t-transparent rounded-full animate-spin"></div>
        <p className="text-sm font-black tracking-widest uppercase opacity-40">Initialisierung...</p>
      </div>
    </div>
  );

  return (
    <div className="max-w-md mx-auto min-h-screen bg-slate-50 flex flex-col font-sans text-slate-900 pb-28 shadow-2xl overflow-hidden">
      
      {/* HEADER */}
      <header className="bg-white/90 backdrop-blur-xl border-b border-slate-100 p-5 flex justify-between items-center sticky top-0 z-50">
        <div>
          <h1 className="text-xl font-black tracking-tighter text-slate-900">DEUTSCH<span className="text-indigo-600">MEISTER</span></h1>
          <div className="flex items-center gap-1.5 mt-0.5">
            <span className="w-1.5 h-1.5 rounded-full bg-emerald-500 shadow-sm animate-pulse"></span>
            <p className="text-[9px] font-bold text-slate-400 uppercase tracking-widest">
                Tag {daysPassed + 1}/547 ‚Ä¢ C1 Blueprint
            </p>
          </div>
        </div>
        <button 
            onClick={() => (!user || user.isAnonymous) ? signInWithPopup(auth, new GoogleAuthProvider()) : signOut(auth)}
            className="w-11 h-11 rounded-2xl bg-indigo-50 flex items-center justify-center border-2 border-indigo-100 transition-all hover:scale-105 active:scale-95 shadow-sm overflow-hidden"
        >
            {user && !user.isAnonymous ? (
                <img src={user.photoURL} className="w-full h-full object-cover" alt="Profile" />
            ) : (
                <Award className="text-indigo-600 w-5 h-5" />
            )}
        </button>
      </header>

      <main className="p-6 flex-grow overflow-y-auto">

        {/* Plateau Alert */}
        {isPlateauPhase && (
          <div className="bg-amber-50 border border-amber-200 p-5 rounded-3xl mb-6 flex gap-4 items-start shadow-sm">
            <AlertTriangle className="text-amber-500 w-6 h-6 flex-shrink-0" />
            <div>
              <h4 className="font-bold text-amber-900 text-sm">–í–Ω–∏–º–∞–Ω–∏–µ: –ü–ª–∞—Ç–æ B1</h4>
              <p className="text-[11px] text-amber-700 leading-relaxed mt-1">
                  –í—ã –Ω–∞ 9-–º –º–µ—Å—è—Ü–µ. –†–µ–∫–æ–º–µ–Ω–¥–æ–≤–∞–Ω 2-–Ω–µ–¥–µ–ª—å–Ω—ã–π –ø–µ—Ä–µ—Ä—ã–≤ –æ—Ç Anki. –§–æ–∫—É—Å–∏—Ä—É–π—Ç–µ—Å—å –Ω–∞ —á–∏—Å—Ç–æ–º –ø–æ–≥—Ä—É–∂–µ–Ω–∏–∏.
              </p>
            </div>
          </div>
        )}

        {/* VIEW: HOME */}
        {view === 'home' && (
          <div className="space-y-6 animate-in slide-in-from-bottom-4 duration-500">
            
            <div className="flex justify-between items-end">
                <div className="space-y-1">
                  <h2 className="text-sm font-bold text-slate-400 uppercase tracking-tighter">Schritt {daysPassed + 1}</h2>
                  <p className="text-3xl font-black text-slate-900 tracking-tighter">
                    {isDayA ? '–¶–∏–∫–ª –ê' : '–¶–∏–∫–ª –ë'}
                  </p>
                </div>
                <div className="flex flex-col items-end gap-1.5">
                    <span className="text-[10px] font-black text-indigo-600 bg-indigo-50 px-3 py-1 rounded-full border border-indigo-200 uppercase tracking-tighter">{currentPhase.level}</span>
                    <span className="text-[10px] text-orange-500 font-extrabold flex items-center gap-1">
                        <Flame className="w-3.5 h-3.5 fill-orange-500" /> {state.streak} –î–ù–ï–ô
                    </span>
                </div>
            </div>

            {/* Daily Task List */}
            <div className="bg-slate-900 rounded-[2.5rem] p-8 text-white shadow-2xl shadow-indigo-200 relative overflow-hidden">
                <div className="relative z-10">
                    <div className="flex items-center gap-2 mb-3">
                        <span className={`w-2.5 h-2.5 rounded-full ${isDayA ? 'bg-indigo-400' : 'bg-emerald-400'} shadow-[0_0_10px_rgba(255,255,255,0.3)]`}></span>
                        <p className="text-[10px] font-bold text-indigo-300 uppercase tracking-widest">
                            {isDayA ? '–ê–ù–ê–õ–ò–ó & –í–í–û–î' : '–°–ò–ù–¢–ï–ó & –í–´–í–û–î'}
                        </p>
                    </div>
                    <h3 className="text-2xl font-black mb-8 leading-tight">40 –ú–ò–ù–£–¢<br/><span className="text-indigo-400 uppercase tracking-tighter">–ò–ù–¢–ï–ù–°–ò–í–ê</span></h3>
                    <div className="space-y-4">
                        {activeTasks.map(task => (
                            <div 
                              key={task.id} 
                              onClick={() => handleToggleTask(task.id)} 
                              className="group flex items-center gap-4 bg-white/5 p-4 rounded-3xl border border-white/5 cursor-pointer active:scale-95 transition-all hover:bg-white/10"
                            >
                                <div className={`h-7 w-7 rounded-xl border-2 flex items-center justify-center transition-all ${state.completedTasks.includes(task.id) ? 'bg-indigo-500 border-indigo-500' : 'border-white/20'}`}>
                                    {state.completedTasks.includes(task.id) && <CheckCircle2 className="w-4 h-4 text-white" />}
                                </div>
                                <div className="flex-grow">
                                    <p className={`font-bold text-[13px] ${state.completedTasks.includes(task.id) ? 'line-through opacity-40 text-slate-400' : ''}`}>{task.title}</p>
                                    <p className="text-[9px] font-bold text-white/40 uppercase tracking-widest mt-0.5">{task.time} –ú–ò–ù ‚Ä¢ {task.type}</p>
                                </div>
                            </div>
                        ))}
                    </div>
                </div>
                <div className="absolute -bottom-16 -right-16 w-64 h-64 bg-indigo-600/20 blur-[100px] rounded-full"></div>
            </div>

            {/* Visual Breakdown */}
            <div className="bg-white p-8 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-6">
                <div className="flex items-center justify-between">
                    <p className="text-[10px] font-black text-slate-400 uppercase tracking-widest">–ë–∞–ª–∞–Ω—Å –¥–Ω—è</p>
                    <span className="text-[10px] font-bold text-indigo-600 px-3 py-1 bg-indigo-50 rounded-full">{isDayA ? 'INPUT' : 'OUTPUT'}</span>
                </div>
                <div className="flex flex-col items-center">
                  <DonutChart tasks={activeTasks} />
                  <div className="mt-4 flex gap-4">
                    {['#6366f1', '#f59e0b', '#10b981'].map((c, i) => (
                      <div key={i} className="flex items-center gap-1.5">
                        <div className="w-2 h-2 rounded-full" style={{backgroundColor: c}}></div>
                        <span className="text-[9px] font-bold text-slate-400 uppercase">{activeTasks[i]?.type}</span>
                      </div>
                    ))}
                  </div>
                </div>
            </div>
          </div>
        )}

        {/* VIEW: METHODOLOGY */}
        {view === 'method' && (
          <div className="space-y-6 animate-in fade-in duration-300">
            <h2 className="text-2xl font-black px-1 leading-tight text-slate-900">–ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è C1</h2>
            
            {/* Anki CSS */}
            <div className="bg-white p-7 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-4">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-indigo-50 rounded-xl flex items-center justify-center">
                        <Zap className="text-indigo-600 w-5 h-5" />
                    </div>
                    <h4 className="font-black text-slate-800">Anki Gender Styler</h4>
                </div>
                <p className="text-xs text-slate-500 leading-relaxed">
                    –î–æ–±–∞–≤—å—Ç–µ —ç—Ç–æ—Ç CSS –≤ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –∫–∞—Ä—Ç Anki –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –º–∞—Ä–∫–∏—Ä–æ–≤–∫–∏ —Ä–æ–¥–æ–≤:
                </p>
                <div className="space-y-2">
                    <div className="p-3 bg-indigo-50 text-indigo-700 rounded-2xl text-[10px] font-mono border border-indigo-100">.der {`{ color: #4f46e5; }`}</div>
                    <div className="p-3 bg-rose-50 text-rose-700 rounded-2xl text-[10px] font-mono border border-rose-100">.die {`{ color: #e11d48; }`}</div>
                    <div className="p-3 bg-emerald-50 text-emerald-700 rounded-2xl text-[10px] font-mono border border-emerald-100">.das {`{ color: #059669; }`}</div>
                </div>
            </div>

            {/* AI Console */}
            <div className="bg-slate-900 p-8 rounded-[2.5rem] text-white space-y-5">
                <div className="flex items-center gap-3">
                    <div className="w-10 h-10 bg-white/10 rounded-xl flex items-center justify-center">
                        <Zap className="text-indigo-400 w-5 h-5" />
                    </div>
                    <h4 className="font-black text-lg">AI Tutor Prompt</h4>
                </div>
                <div className="bg-white/5 p-6 rounded-3xl border border-white/5 space-y-4">
                    <p className="text-[11px] text-slate-300 leading-relaxed italic">
                        –≠—Ç–æ—Ç –ø—Ä–æ–º–ø—Ç –ø—Ä–µ–≤—Ä–∞—â–∞–µ—Ç ChatGPT –≤ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–≥–æ DaF-–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—è –¥–ª—è —É—Ä–æ–≤–Ω—è <strong>{currentPhase.level}</strong>.
                    </p>
                    <button 
                        onClick={copyPrompt}
                        className="w-full bg-indigo-600 py-4 rounded-2xl text-xs font-black uppercase tracking-widest hover:bg-indigo-700 active:scale-95 transition-all shadow-lg flex items-center justify-center gap-2"
                    >
                        <Copy className="w-4 h-4" /> {copyStatus || '–°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å'}
                    </button>
                </div>
            </div>

            {/* SST Protocol */}
            <div className="bg-white p-7 rounded-[2.5rem] border border-slate-100 shadow-sm border-l-8 border-l-indigo-600">
                <h4 className="font-black text-slate-800 text-sm mb-2">–ü—Ä–∞–≤–∏–ª–æ SST (70/30)</h4>
                <p className="text-xs text-slate-500 leading-relaxed">
                   –ù–∞ —É—Ä–æ–∫–µ —Å —Ä–µ–ø–µ—Ç–∏—Ç–æ—Ä–æ–º –≥–æ–≤–æ—Ä–∏—Ç–µ 70% –≤—Ä–µ–º–µ–Ω–∏. –ü—Ä–∏—Ö–æ–¥–∏—Ç–µ —Å –≥–æ—Ç–æ–≤—ã–º –∞–Ω–∞–ª–∏–∑–æ–º –î–Ω—è –ê. –£—á–∏—Ç–µ–ª—å ‚Äî —Ç–æ–ª—å–∫–æ –∫–æ—Ä—Ä–µ–∫—Ç–æ—Ä.
                </p>
            </div>
          </div>
        )}

        {/* VIEW: ROADMAP */}
        {view === 'map' && (
          <div className="space-y-4 animate-in fade-in duration-300">
            <h2 className="text-2xl font-black mb-6 px-1">–î–æ—Ä–æ–∂–Ω–∞—è –ö–∞—Ä—Ç–∞</h2>
            <div className="space-y-4">
                {PHASES.map((p) => (
                <div 
                    key={p.id} 
                    onClick={() => {
                        if(window.confirm(`–ü–µ—Ä–µ–∫–ª—é—á–∏—Ç—å—Å—è –Ω–∞ —ç—Ç–∞–ø ${p.level} –≤—Ä—É—á–Ω—É—é?`)) {
                            const ns = {...state, currentPhaseId: p.id, completedTasks: []};
                            setState(ns);
                            saveToCloud(ns);
                            setView('home');
                        }
                    }}
                    className={`p-6 rounded-[2.5rem] border-2 transition-all cursor-pointer relative overflow-hidden ${state.currentPhaseId === p.id ? 'bg-indigo-600 text-white border-indigo-500 shadow-xl' : 'bg-white border-slate-100 opacity-60'}`}
                >
                    <div className="flex justify-between items-center mb-3">
                        <span className={`text-[10px] font-black uppercase px-2.5 py-1 rounded-full ${state.currentPhaseId === p.id ? 'bg-white/20' : 'bg-slate-100 text-slate-500'}`}>{p.days} TAGE</span>
                        <span className={`font-black text-2xl ${state.currentPhaseId === p.id ? 'text-white' : 'text-indigo-600'}`}>{p.level}</span>
                    </div>
                    <h3 className="font-black text-xl mb-1">{p.name}</h3>
                    <p className={`text-[11px] font-medium leading-relaxed ${state.currentPhaseId === p.id ? 'text-indigo-100' : 'text-slate-500'}`}>
                        <strong>–§–æ–∫—É—Å:</strong> {p.focus}
                    </p>
                </div>
                ))}
            </div>
          </div>
        )}

        {/* VIEW: SETTINGS */}
        {view === 'settings' && (
          <div className="space-y-6 animate-in fade-in duration-300">
            <h2 className="text-2xl font-black px-1 leading-tight text-slate-900">–ù–∞—Å—Ç—Ä–æ–π–∫–∏</h2>
            
            <div className="bg-white p-7 rounded-[2.5rem] border border-slate-100 shadow-sm space-y-6">
                <div className="flex items-center justify-between">
                    <div>
                        <p className="font-black text-slate-800 text-sm tracking-tight">–ê–í–¢–û-–ú–û–î–£–õ–ò</p>
                        <p className="text-[10px] text-slate-400 font-bold tracking-wider">–ì–†–ê–§–ò–ö: 1.5 –ì–û–î–ê</p>
                    </div>
                    <button 
                        onClick={() => {
                            const ns = { ...state, autoAdvance: !state.autoAdvance };
                            setState(ns);
                            saveToCloud(ns);
                        }} 
                        className={`w-14 h-7 rounded-full transition-all relative ${state.autoAdvance ? 'bg-indigo-600' : 'bg-slate-300'}`}
                    >
                        <div className={`absolute top-1 w-5 h-5 bg-white rounded-full transition-transform shadow-md ${state.autoAdvance ? 'left-8' : 'left-1'}`}></div>
                    </button>
                </div>

                <div className="pt-6 border-t border-slate-50 flex flex-col gap-4">
                    <button onClick={() => window.open(`https://www.google.com/calendar/render?action=TEMPLATE&text=DeutschMeister%20Lernen&recur=RRULE:FREQ=DAILY`, '_blank')} className="w-full flex items-center justify-between p-5 bg-indigo-50 rounded-3xl text-indigo-700 font-black text-[11px] uppercase tracking-widest transition-all active:scale-95 border border-indigo-100">
                        <span>Google –ö–∞–ª–µ–Ω–¥–∞—Ä—å</span>
                        <Calendar className="w-5 h-5" />
                    </button>
                    
                    <button onClick={() => {
                        if(window.confirm('–°–±—Ä–æ—Å–∏—Ç—å –≤–µ—Å—å –ø—Ä–æ–≥—Ä–µ—Å—Å? –≠—Ç–æ –Ω–µ–æ–±—Ä–∞—Ç–∏–º–æ.')) {
                            const ns = { ...state, startDate: new Date().toISOString(), currentPhaseId: 0, streak: 0, completedTasks: [] };
                            setState(ns);
                            saveToCloud(ns);
                        }
                    }} className="w-full p-5 text-center text-rose-500 font-black text-[10px] uppercase tracking-widest bg-rose-50 rounded-3xl active:scale-95 transition-all border border-rose-100">
                        –°–±—Ä–æ—Å–∏—Ç—å –ø—Ä–æ–≥—Ä–µ—Å—Å
                    </button>
                </div>
            </div>
          </div>
        )}

      </main>

      {/* BOTTOM NAVIGATION */}
      <nav className="fixed bottom-0 left-0 right-0 bg-white/90 backdrop-blur-xl border-t border-slate-100 px-6 pb-10 pt-4 z-50">
        <div className="max-w-md mx-auto flex justify-between items-center">
          <button onClick={() => setView('home')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'home' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}>
            <Zap className="w-6 h-6" />
            <span className="text-[9px] font-black uppercase tracking-widest">–¶–∏–∫–ª</span>
          </button>
          <button onClick={() => setView('map')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'map' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}>
            <Map className="w-6 h-6" />
            <span className="text-[9px] font-black uppercase tracking-widest">–ö–∞—Ä—Ç–∞</span>
          </button>
          <button onClick={() => setView('method')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'method' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}>
            <BookOpen className="w-6 h-6" />
            <span className="text-[9px] font-black uppercase tracking-widest">–ú–µ—Ç–æ–¥</span>
          </button>
          <button onClick={() => setView('settings')} className={`flex flex-col items-center gap-1.5 transition-all ${view === 'settings' ? 'text-indigo-600 scale-110' : 'text-slate-400 opacity-60'}`}>
            <Settings className="w-6 h-6" />
            <span className="text-[9px] font-black uppercase tracking-widest">–û–ø—Ü–∏–∏</span>
          </button>
        </div>
      </nav>

    </div>
  );
}


                    </div>
                </div>

                <!-- Methodology Details -->
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h4 class="text-lg font-bold text-gray-800 mb-4 flex items-center gap-2">
                        <span>üß†</span> –ú–µ—Ç–æ–¥–æ–ª–æ–≥–∏—è —ç—Ç–∞–ø–∞
                    </h4>
                    <ul id="phase-method" class="space-y-3 text-gray-600">
                        <!-- List items via JS -->
                    </ul>
                </div>

                <!-- Daily 40-min Routine Text -->
                <div class="bg-amber-50 rounded-xl p-6 border border-amber-100">
                    <h4 class="text-lg font-bold text-amber-900 mb-3 flex items-center gap-2">
                        <span>‚è∞</span> –ï–∂–µ–¥–Ω–µ–≤–Ω—ã–π –ø–ª–∞–Ω (40 –º–∏–Ω—É—Ç)
                    </h4>
                    <p class="text-sm text-amber-800 mb-4">
                        –°—Ç—Ä–æ–≥–∞—è –¥–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ –≤–∞–∂–Ω–∞. –ù–µ –ø—Ä–æ–ø—É—Å–∫–∞–π—Ç–µ –¥–Ω–∏.
                    </p>
                    <div id="routine-list" class="space-y-2">
                        <!-- Routine items via JS -->
                    </div>
                </div>

            </div>

            <!-- Right Column: Visuals & Metrics -->
            <div class="lg:col-span-5 space-y-6">
                
                <!-- Chart: Time Split -->
                <div class="bg-white rounded-xl p-6 shadow-sm border border-gray-100">
                    <h4 class="text-sm font-semibold text-gray-500 uppercase tracking-wider mb-4 text-center">–†–∞—Å–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ –≤—Ä–µ–º–µ–Ω–∏ (–º–∏–Ω)</h4>
                    <div class="chart-container">
                        <canvas id="routineChart"></canvas>
                    </div>
                    <p class="text-center text-xs text-gray-400 mt-2">–î–∏–Ω–∞–º–∏—á–µ—Å–∫–∏ –º–µ–Ω—è–µ—Ç—Å—è –¥–ª—è –∫–∞–∂–¥–æ–≥–æ —ç—Ç–∞–ø–∞</p>
                </div>

                <!-- Key Metrics Cards -->
                <div class="grid grid-cols-2 gap-4">
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm text-center">
                        <div class="text-2xl font-bold text-blue-600 mb-1" id="metric-vocab">0</div>
                        <div class="text-xs text-gray-500">–°–ª–æ–≤ (–∞–∫—Ç–∏–≤–Ω—ã—Ö)</div>
                    </div>
                    <div class="bg-white p-4 rounded-xl border border-gray-100 shadow-sm text-center">
                        <div class="text-2xl font-bold text-emerald-600 mb-1" id="metric-hours">0</div>
                        <div class="text-xs text-gray-500">–ß–∞—Å–æ–≤ –ø–æ–≥—Ä—É–∂–µ–Ω–∏—è</div>
                    </div>
                </div>

            </div>
        </section>

        <!-- Technical Setup Guide (Static but accordion-like) -->
        <section id="setup" class="bg-gray-50 rounded-2xl p-6 md:p-8 border border-gray-200">
            <div class="mb-8">
                <h3 class="text-2xl font-bold text-gray-900 mb-2">üõ† –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –ø–æ –Ω–∞—Å—Ç—Ä–æ–π–∫–µ (Setup)</h3>
                <p class="text-gray-600">
                    –í–∞—à —É—Å–ø–µ—Ö –Ω–∞ 80% –∑–∞–≤–∏—Å–∏—Ç –æ—Ç —Å–∏—Å—Ç–µ–º—ã. –°–∫–∞—á–∞–π—Ç–µ –∏ –Ω–∞—Å—Ç—Ä–æ–π—Ç–µ —ç—Ç–∏ –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ —Å—Ç–∞—Ä—Ç–æ–º.
                </p>
            </div>

            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                
                <!-- Tool Card 1: Anki -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-gray-800">1. Anki (–ò–Ω—Ç–µ—Ä–≤–∞–ª—å–Ω—ã–µ –ø–æ–≤—Ç–æ—Ä–µ–Ω–∏—è)</h4>
                        <span class="text-2xl">üóÇÔ∏è</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">–ì–ª–∞–≤–Ω—ã–π –∏–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç –¥–ª—è —Å–ª–æ–≤. –ó–∞–±—ã–≤–∞–Ω–∏–µ - —ç—Ç–æ —á–∞—Å—Ç—å –ø—Ä–æ—Ü–µ—Å—Å–∞, Anki –æ–ø—Ç–∏–º–∏–∑–∏—Ä—É–µ—Ç —ç—Ç–æ.</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-4 list-disc pl-4">
                        <li>–°–∫–∞—á–∞—Ç—å <a href="#" class="text-blue-600 hover:underline">AnkiWeb</a> (PC/Mac).</li>
                        <li>–ù–∞–π—Ç–∏ –∫–æ–ª–æ–¥—É: "Goethe Institut A1 Wordlist" –∏–ª–∏ "4000 German Words by Frequency".</li>
                        <li><strong>–ù–∞—Å—Ç—Ä–æ–π–∫–∞:</strong> –ü–æ—Å—Ç–∞–≤—å—Ç–µ –ª–∏–º–∏—Ç "New cards" –Ω–∞ 10-15 –≤ –¥–µ–Ω—å, –Ω–µ –±–æ–ª—å—à–µ.</li>
                    </ul>
                </div>

                <!-- Tool Card 2: Dictionary -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-gray-800">2. –°–ª–æ–≤–∞—Ä–∏ –∏ –ü–µ—Ä–µ–≤–æ–¥—á–∏–∫–∏</h4>
                        <span class="text-2xl">üìñ</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">–ù–µ –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ Google Translate –¥–ª—è –æ–±—É—á–µ–Ω–∏—è. –ù—É–∂–µ–Ω –∫–æ–Ω—Ç–µ–∫—Å—Ç.</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-4 list-disc pl-4">
                        <li><strong>Reverso Context:</strong> –î–ª—è —Ñ—Ä–∞–∑ –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–µ.</li>
                        <li><strong>DeepL:</strong> –õ—É—á—à–∏–π –Ω–µ–π—Ä–æ—Å–µ—Ç–µ–≤–æ–π –ø–µ—Ä–µ–≤–æ–¥—á–∏–∫.</li>
                        <li><strong>Verbformen.de:</strong> –î–ª—è —Å–ø—Ä—è–∂–µ–Ω–∏—è –≥–ª–∞–≥–æ–ª–æ–≤ (—Å–≤—è—Ç–∞—è –≤–µ—â—å –¥–ª—è –Ω–µ–º–µ—Ü–∫–æ–≥–æ).</li>
                    </ul>
                </div>

                <!-- Tool Card 3: Content Sources -->
                <div class="bg-white p-5 rounded-xl shadow-sm border border-gray-200">
                    <div class="flex items-center justify-between mb-3">
                        <h4 class="font-bold text-gray-800">3. –ò—Å—Ç–æ—á–Ω–∏–∫–∏ –ü–æ–≥—Ä—É–∂–µ–Ω–∏—è</h4>
                        <span class="text-2xl">üéß</span>
                    </div>
                    <p class="text-sm text-gray-600 mb-3">–ò—Å—Ç–æ—á–Ω–∏–∫–∏ –¥–ª—è —Ñ–∞–∑—ã "Accumulation" –∏ –¥–∞–ª—å—à–µ.</p>
                    <ul class="text-sm text-gray-700 space-y-2 mb-4 list-disc pl-4">
                        <li><strong>YouTube:</strong> Easy German (Street interviews), Dinge Erkl√§rt (Kurzgesagt).</li>
                        <li><strong>Deutsche Welle:</strong> Nicos Weg (–ò–Ω—Ç–µ—Ä–∞–∫—Ç–∏–≤–Ω—ã–π —Å–µ—Ä–∏–∞–ª, –º–∞—Å—Ç-—Ö—ç–≤).</li>
                        <li><strong>Netflix:</strong> Dark, How to Sell Drugs Online (Fast).</li>
                    </ul>
                </div>

            </div>
        </section>

        <!-- Long Term Stats -->
        <section class="bg-white rounded-2xl shadow-sm border border-gray-100 p-6">
            <div class="flex flex-col md:flex-row items-center justify-between mb-6">
                <div>
                    <h3 class="text-xl font-bold text-gray-900">–ö—Ä–∏–≤–∞—è –°–ª–æ–≤–∞—Ä–Ω–æ–≥–æ –ó–∞–ø–∞—Å–∞</h3>
                    <p class="text-sm text-gray-500">–≠–∫—Å–ø–æ–Ω–µ–Ω—Ü–∏–∞–ª—å–Ω—ã–π —Ä–æ—Å—Ç –Ω–µ–æ–±—Ö–æ–¥–∏–º –¥–ª—è –ø–æ–Ω–∏–º–∞–Ω–∏—è –Ω–∞—Ç–∏–≤–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞.</p>
                </div>
            </div>
            <div class="chart-container" style="max-width: 800px; height: 350px;">
                <canvas id="growthChart"></canvas>
            </div>
        </section>

    </main>

    <footer class="bg-gray-50 border-t border-gray-200 mt-12 py-8">
        <div class="max-w-6xl mx-auto px-4 text-center text-gray-500 text-sm">
            <p>¬© 2024 DeutschMeister Interactive Plan. –û—Å–Ω–æ–≤–∞–Ω–æ –Ω–∞ –ø—Ä–∏–Ω—Ü–∏–ø–∞—Ö Comprehensible Input.</p>
            <p class="mt-2">–î–∏—Å—Ü–∏–ø–ª–∏–Ω–∞ > –ú–æ—Ç–∏–≤–∞—Ü–∏—è. Viel Erfolg!</p>
        </div>
    </footer>

    <script>
        // --- DATA STATE ---
        // Defines the content and metrics for each phase of the 1.5 year journey
        const appData = [
            {
                id: 0,
                title: "–§–∞–∑–∞ 1: –§—É–Ω–¥–∞–º–µ–Ω—Ç (Start)",
                duration: "–ú–µ—Å—è—Ü 0-3",
                goal: "A1 - –í—ã–∂–∏–≤–∞–Ω–∏–µ",
                level: "A0 -> A1",
                desc: "–°–∞–º—ã–π —Å–ª–æ–∂–Ω—ã–π —ç—Ç–∞–ø. –í–∞—à –º–æ–∑–≥ —Å–æ–ø—Ä–æ—Ç–∏–≤–ª—è–µ—Ç—Å—è –Ω–æ–≤–æ–º—É —è–∑—ã–∫—É. –ó–∞–¥–∞—á–∞: –∑–∞–≥—Ä—É–∑–∏—Ç—å –±–∞–∑—É —Ñ–æ–Ω–µ—Ç–∏–∫–∏ –∏ —Å–∞–º—ã–µ —á–∞—Å—Ç—ã–µ —Å–ª–æ–≤–∞, –Ω–µ –æ–±—Ä–∞—â–∞—è –≤–Ω–∏–º–∞–Ω–∏—è –Ω–∞ —Å–ª–æ–∂–Ω—ã–µ –ø—Ä–∞–≤–∏–ª–∞.",
                method: [
                    "<strong>–§–æ–Ω–µ—Ç–∏–∫–∞:</strong> –ü–æ—Ç—Ä–∞—Ç—å—Ç–µ –ø–µ—Ä–≤—ã–µ 2 –Ω–µ–¥–µ–ª–∏ —Ç–æ–ª—å–∫–æ –Ω–∞ –ø—Ä–∞–≤–∏–ª–∞ —á—Ç–µ–Ω–∏—è –∏ –ø—Ä–æ–∏–∑–Ω–æ—à–µ–Ω–∏–µ. –ï—Å–ª–∏ –≤—ã—É—á–∏—Ç–µ –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–æ —Å–µ–π—á–∞—Å, –∏—Å–ø—Ä–∞–≤–ª—è—Ç—å –±—É–¥–µ—Ç–µ –≥–æ–¥–∞–º–∏.",
                    "<strong>–õ–µ–∫—Å–∏–∫–∞:</strong> –¢–æ–ø-500 —Å–∞–º—ã—Ö —á–∞—Å—Ç–æ—Ç–Ω—ã—Ö —Å–ª–æ–≤. –£—á–∏—Ç–µ —Å—É—â–µ—Å—Ç–≤–∏—Ç–µ–ª—å–Ω—ã–µ –°–†–ê–ó–£ —Å –∞—Ä—Ç–∏–∫–ª–µ–º (Der/Die/Das) –∏ –º–Ω–æ–∂–µ—Å—Ç–≤–µ–Ω–Ω—ã–º —á–∏—Å–ª–æ–º.",
                    "<strong>–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞:</strong> –¢–æ–ª—å–∫–æ Present Tense, –±–∞–∑–æ–≤—ã–π –ø–æ—Ä—è–¥–æ–∫ —Å–ª–æ–≤ (–≥–ª–∞–≥–æ–ª –Ω–∞ 2 –º–µ—Å—Ç–µ), –æ—Ç—Ä–∏—Ü–∞–Ω–∏–µ (nicht/kein)."
                ],
                routine: [
                    { activity: "Anki (–°–ª–æ–≤–∞)", time: 15, color: "#3B82F6" },
                    { activity: "–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ (–£—á–µ–±–Ω–∏–∫)", time: 15, color: "#F59E0B" },
                    { activity: "–ê—É–¥–∏—Ä–æ–≤–∞–Ω–∏–µ (–§–æ–Ω)", time: 10, color: "#10B981" }
                ],
                metrics: { vocab: "500-800", hours: "60" }
            },
            {
                id: 1,
                title: "–§–∞–∑–∞ 2: –ù–∞–∫–æ–ø–ª–µ–Ω–∏–µ (Input)",
                duration: "–ú–µ—Å—è—Ü 4-9",
                goal: "A2/B1 - –ü–æ–Ω–∏–º–∞–Ω–∏–µ",
                level: "A1 -> B1",
                desc: "–ó–æ–ª–æ—Ç–æ–µ –≤—Ä–µ–º—è. –í—ã –º–µ–Ω—å—à–µ —É—á–∏—Ç–µ –ø—Ä–∞–≤–∏–ª–∞ –∏ –±–æ–ª—å—à–µ –ø–æ—Ç—Ä–µ–±–ª—è–µ—Ç–µ –∫–æ–Ω—Ç–µ–Ω—Ç. –ú—ã –ø–µ—Ä–µ—Ö–æ–¥–∏–º –æ—Ç —É—á–µ–±–Ω–∏–∫–æ–≤ –∫ –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º –º–∞—Ç–µ—Ä–∏–∞–ª–∞–º.",
                method: [
                    "<strong>Nicos Weg:</strong> –ü—Ä–æ–π–¥–∏—Ç–µ –∫—É—Ä—Å A2 –Ω–∞ Deutsche Welle.",
                    "<strong>Easy German:</strong> –°–º–æ—Ç—Ä–∏—Ç–µ –≤–∏–¥–µ–æ —Å —Å—É–±—Ç–∏—Ç—Ä–∞–º–∏. –û—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–π—Ç–µ, –≤—ã–ø–∏—Å—ã–≤–∞–π—Ç–µ –∏–Ω—Ç–µ—Ä–µ—Å–Ω—ã–µ —Ñ—Ä–∞–∑—ã.",
                    "<strong>Graded Readers:</strong> –ö–Ω–∏–≥–∏, –∞–¥–∞–ø—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ –ø–æ–¥ —É—Ä–æ–≤–µ–Ω—å A2. –ß–∏—Ç–∞–π—Ç–µ –±–µ–∑ —Å–ª–æ–≤–∞—Ä—è, —Å—Ç–∞—Ä–∞—è—Å—å –ø–æ–Ω—è—Ç—å —Å–º—ã—Å–ª –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞."
                ],
                routine: [
                    { activity: "Anki (–ü–æ–≤—Ç–æ—Ä–µ–Ω–∏–µ)", time: 10, color: "#3B82F6" },
                    { activity: "–ü–æ—Ç—Ä–µ–±–ª–µ–Ω–∏–µ (Reading/Video)", time: 25, color: "#10B981" },
                    { activity: "–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ (–°–ø—Ä–∞–≤–æ—á–Ω–æ)", time: 5, color: "#F59E0B" }
                ],
                metrics: { vocab: "2000+", hours: "180" }
            },
            {
                id: 2,
                title: "–§–∞–∑–∞ 3: –ê–∫—Ç–∏–≤–∞—Ü–∏—è (Output)",
                duration: "–ú–µ—Å—è—Ü 10-15",
                goal: "B2 - –°–≤–æ–±–æ–¥–∞",
                level: "B1 -> B2",
                desc: "–í—ã –º–Ω–æ–≥–æ –ø–æ–Ω–∏–º–∞–µ—Ç–µ, –Ω–æ –≥–æ–≤–æ—Ä–∏—Ç–µ —Å —Ç—Ä—É–¥–æ–º. –ü–æ—Ä–∞ –ª–æ–º–∞—Ç—å —è–∑—ã–∫–æ–≤–æ–π –±–∞—Ä—å–µ—Ä. –ù–∞—á–∏–Ω–∞–µ–º –ø–∏—Å–∞—Ç—å –∏ –≥–æ–≤–æ—Ä–∏—Ç—å, –¥–∞–∂–µ —Å –æ—à–∏–±–∫–∞–º–∏.",
                method: [
                    "<strong>–¢–∞–Ω–¥–µ–º/iTalki:</strong> –ù–∞–π–¥–∏—Ç–µ –ø–∞—Ä—Ç–Ω–µ—Ä–∞. 1-2 —Ä–∞–∑–∞ –≤ –Ω–µ–¥–µ–ª—é —Ä–∞–∑–≥–æ–≤–æ—Ä–Ω–∞—è –ø—Ä–∞–∫—Ç–∏–∫–∞.",
                    "<strong>Shadowing:</strong> –ü–æ–≤—Ç–æ—Ä—è–π—Ç–µ –∑–∞ –¥–∏–∫—Ç–æ—Ä–æ–º –≤—Å–ª—É—Ö, –∫–æ–ø–∏—Ä—É—è –∏–Ω—Ç–æ–Ω–∞—Ü–∏—é.",
                    "<strong>–ü–∏—Å—å–º–æ:</strong> –ü–∏—à–∏—Ç–µ –∫–æ—Ä–æ—Ç–∫–∏–µ —ç—Å—Å–µ (5 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π) –æ –ø—Ä–æ—à–µ–¥—à–µ–º –¥–Ω–µ. –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ –≤ DeepL (–æ–±—Ä–∞—Ç–Ω—ã–π –ø–µ—Ä–µ–≤–æ–¥)."
                ],
                routine: [
                    { activity: "Anki (–§—Ä–∞–∑—ã/–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è)", time: 10, color: "#3B82F6" },
                    { activity: "–ù–∞—Ç–∏–≤–Ω—ã–π –ö–æ–Ω—Ç–µ–Ω—Ç (YouTube)", time: 20, color: "#10B981" },
                    { activity: "–ì–æ–≤–æ—Ä–µ–Ω–∏–µ/–ü–∏—Å—å–º–æ", time: 10, color: "#EF4444" }
                ],
                metrics: { vocab: "3500+", hours: "360" }
            },
            {
                id: 3,
                title: "–§–∞–∑–∞ 4: –ú–∞—Å—Ç–µ—Ä—Å—Ç–≤–æ (Polish)",
                duration: "–ú–µ—Å—è—Ü 16-18",
                goal: "C1 - –ü—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª",
                level: "B2 -> C1",
                desc: "–®–ª–∏—Ñ–æ–≤–∫–∞ –Ω—é–∞–Ω—Å–æ–≤. –í—ã —Ä–∞–±–æ—Ç–∞–µ—Ç–µ –Ω–∞–¥ –∏–¥–∏–æ–º–∞–º–∏, —Å–ª–æ–∂–Ω–æ–π –≥—Ä–∞–º–º–∞—Ç–∏–∫–æ–π (Konjunktiv I/II) –∏ –ø—Ä–æ—Ñ–µ—Å—Å–∏–æ–Ω–∞–ª—å–Ω–æ–π –ª–µ–∫—Å–∏–∫–æ–π.",
                method: [
                    "<strong>–°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–π –∫–æ–Ω—Ç–µ–Ω—Ç:</strong> –ù–æ–≤–æ—Å—Ç–∏ (Tagesschau), –Ω–∞—É—á–Ω—ã–µ –ø–æ–¥–∫–∞—Å—Ç—ã, —Å–æ–≤—Ä–µ–º–µ–Ω–Ω–∞—è –ª–∏—Ç–µ—Ä–∞—Ç—É—Ä–∞.",
                    "<strong>–ú–æ–Ω–æ—è–∑—ã—á–Ω—ã–π —Å–ª–æ–≤–∞—Ä—å:</strong> Duden. –ó–∞–±—É–¥—å—Ç–µ –ø—Ä–æ –ø–µ—Ä–µ–≤–æ–¥ –Ω–∞ —Ä—É—Å—Å–∫–∏–π. –û–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å–ª–æ–≤–∞ —á–∏—Ç–∞–µ–º –Ω–∞ –Ω–µ–º–µ—Ü–∫–æ–º.",
                    "<strong>–¢–µ—Å—Ç—ã:</strong> –ü—Ä–æ—Ä–µ—à–∏–≤–∞–Ω–∏–µ –ø—Ä–æ–±–Ω—ã—Ö —Ç–µ—Å—Ç–æ–≤ Goethe C1 / TestDaF."
                ],
                routine: [
                    { activity: "Anki (–°–ª–æ–∂–Ω—ã–µ –Ω—é–∞–Ω—Å—ã)", time: 5, color: "#3B82F6" },
                    { activity: "–°–ª–æ–∂–Ω—ã–π –ö–æ–Ω—Ç–µ–Ω—Ç (–ù–æ–≤–æ—Å—Ç–∏)", time: 30, color: "#10B981" },
                    { activity: "–ì—Ä–∞–º–º–∞—Ç–∏–∫–∞ C1", time: 5, color: "#F59E0B" }
                ],
                metrics: { vocab: "5000+", hours: "500+" }
            }
        ];

        let currentPhase = 0;
        let routineChartInstance = null;
        let growthChartInstance = null;

        // --- INIT ---
        document.addEventListener('DOMContentLoaded', () => {
            renderPhaseNav();
            loadPhase(0);
            renderGrowthChart();
        });

        // --- RENDERERS ---

        function renderPhaseNav() {
            const navContainer = document.getElementById('phase-nav');
            navContainer.innerHTML = appData.map((phase, index) => `
                <button 
                    onclick="loadPhase(${index})"
                    class="phase-btn flex flex-col items-center justify-center p-3 rounded-xl border border-gray-200 transition-all hover:bg-gray-50 ${index === 0 ? 'active' : 'bg-white text-gray-600'}"
                    id="btn-phase-${index}"
                >
                    <span class="text-xs font-bold uppercase mb-1 opacity-70">${phase.duration}</span>
                    <span class="text-sm md:text-base font-bold text-center leading-tight">${phase.title.split(':')[0]}</span>
                    <span class="text-xs mt-1 text-center hidden md:block">${phase.level}</span>
                </button>
            `).join('');
        }

        function loadPhase(index) {
            currentPhase = index;
            const data = appData[index];

            // Update Active Button State
            document.querySelectorAll('.phase-btn').forEach(btn => {
                btn.classList.remove('active', 'bg-blue-500', 'text-white', 'border-blue-500', 'shadow-md');
                btn.classList.add('bg-white', 'text-gray-600');
            });
            const activeBtn = document.getElementById(`btn-phase-${index}`);
            activeBtn.classList.remove('bg-white', 'text-gray-600');
            activeBtn.classList.add('active', 'shadow-md');

            // Update Text Content
            document.getElementById('phase-title').textContent = data.title;
            document.getElementById('phase-duration').textContent = data.duration;
            document.getElementById('phase-desc').textContent = data.desc;
            document.getElementById('phase-goal').textContent = data.goal;

            // Update Lists
            const methodList = document.getElementById('phase-method');
            methodList.innerHTML = data.method.map(item => `<li class="flex items-start gap-2"><span class="text-blue-500 mt-1">‚úì</span><span class="text-sm leading-relaxed">${item}</span></li>`).join('');

            const routineList = document.getElementById('routine-list');
            routineList.innerHTML = data.routine.map(item => `
                <div class="flex items-center justify-between bg-white p-3 rounded border border-amber-100">
                    <div class="flex items-center gap-2">
                        <span class="w-3 h-3 rounded-full" style="background-color: ${item.color}"></span>
                        <span class="text-sm font-medium text-gray-700">${item.activity}</span>
                    </div>
                    <span class="text-sm font-bold text-gray-900">${item.time} –º–∏–Ω</span>
                </div>
            `).join('');

            // Update Metrics
            animateValue("metric-vocab", parseInt(document.getElementById('metric-vocab').innerText.replace('+','')), parseInt(data.metrics.vocab.replace('+','')), 1000);
            document.getElementById('metric-hours').textContent = data.metrics.hours;

            // Update Chart
            updateRoutineChart(data.routine);
        }

        function scrollToSection(id) {
            document.getElementById(id).scrollIntoView({behavior: 'smooth'});
        }

        // --- CHARTS ---

        function updateRoutineChart(routineData) {
            const ctx = document.getElementById('routineChart').getContext('2d');
            
            const labels = routineData.map(d => d.activity.split('(')[0]); // Short labels
            const dataPoints = routineData.map(d => d.time);
            const colors = routineData.map(d => d.color);

            if (routineChartInstance) {
                routineChartInstance.destroy();
            }

            routineChartInstance = new Chart(ctx, {
                type: 'doughnut',
                data: {
                    labels: labels,
                    datasets: [{
                        data: dataPoints,
                        backgroundColor: colors,
                        borderWidth: 0,
                        hoverOffset: 4
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            position: 'bottom',
                            labels: {
                                usePointStyle: true,
                                boxWidth: 8,
                                font: { size: 11 }
                            }
                        },
                        tooltip: {
                            callbacks: {
                                label: function(context) {
                                    return ` ${context.label}: ${context.raw} –º–∏–Ω`;
                                }
                            }
                        }
                    },
                    cutout: '65%'
                }
            });
        }

        function renderGrowthChart() {
            const ctx = document.getElementById('growthChart').getContext('2d');
            
            // Hypothetical growth curve
            const labels = ["–ú–µ—Å—è—Ü 0", "–ú–µ—Å—è—Ü 3", "–ú–µ—Å—è—Ü 6", "–ú–µ—Å—è—Ü 9", "–ú–µ—Å—è—Ü 12", "–ú–µ—Å—è—Ü 15", "–ú–µ—Å—è—Ü 18"];
            const vocabData = [0, 500, 1200, 2000, 3000, 4000, 5000];
            
            growthChartInstance = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [{
                        label: '–°–ª–æ–≤–∞—Ä–Ω—ã–π –∑–∞–ø–∞—Å (—Å–ª–æ–≤)',
                        data: vocabData,
                        borderColor: '#3B82F6',
                        backgroundColor: 'rgba(59, 130, 246, 0.1)',
                        borderWidth: 3,
                        tension: 0.4,
                        fill: true,
                        pointBackgroundColor: '#fff',
                        pointBorderColor: '#3B82F6',
                        pointRadius: 5
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            grid: {
                                borderDash: [2, 2],
                                color: '#f3f4f6'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            intersect: false,
                            mode: 'index'
                        }
                    }
                }
            });
        }

        // Utility: Number animation
        function animateValue(id, start, end, duration) {
            if (isNaN(end)) return;
            const obj = document.getElementById(id);
            const range = end - start;
            const minTimer = 50;
            let stepTime = Math.abs(Math.floor(duration / range));
            stepTime = Math.max(stepTime, minTimer);
            
            let startTime = new Date().getTime();
            let endTime = startTime + duration;
            let timer;
          
            function run() {
                let now = new Date().getTime();
                let remaining = Math.max((endTime - now) / duration, 0);
                let value = Math.round(end - (remaining * range));
                obj.innerHTML = value + (end > 2000 ? '+' : '');
                if (value == end) {
                    clearInterval(timer);
                }
            }
            
            timer = setInterval(run, stepTime);
            run();
        }

    </script>
</body>
</html>